# ENHANCEMENT

## 光照修复算法Retinex介绍

Retinex基础理论：

1. 物体的颜色是由物体对长波（红色），中波（绿色），短波（蓝色）光线的**反射能力**来决定的，而不是由**反射光强度**的绝对值来决定的。
2. 物体的颜色不受光照非均匀性的影响，具有一致性，即Retinex算法是基于物体的颜色恒常性来实现的。
3. Retinex算法可以将图像的动态颜色范围压缩，边缘增强和颜色恒常三个方面达到平衡，在图像除雾方面有着较好的效果（对正常图像的增强效果不明显）。

### SSR(单尺度Retinex)

根据Retinex算法的基础理论，我们可以得到以下数学表达式：

$$
S(x, y) = R(x, y) \cdot L(x, y) \qquad formula（1）
$$
其中$R(x, y)$表示物体的反射性质，即图像的内在属性，应该最大程度的保留；$L（x,y）$表示入射光图像，决定了图像像素能够达到的动态范围，应该尽量去除；$S（x,y）$为人眼观察到或者相机接收到的图像。
对公式1两边取以10为底的对数得：
$$
r(x,y) = Lg[R(x,y)] = Lg[S(x, y)] - Lg[L(x,y)]
$$
算法的目的在于得到增强的图像$R(x,y)$, $S(x,y)$ 是相机采集到的图像，要求解$R(x,y)$,仅需得到$L(x,y)$即可。在通常情况下，我们使用高斯核对$S(x,y)$卷积得到$L(x,y)$。
算法步骤：
1. 输入高斯模糊的高斯环绕尺度C（即二维高斯函数的标准差）；
2. 根据C对原始图像数据$S(x,y)$做高斯模糊得到$L(x,y)$;
3. 根据公式1对$S(x,y)$和$L(x,y)$分别取对数并作差得到r(x,y);
4. 将$r(x,y)$的像素值量化到0到255的范围内得到$R(x,y)$，$R(x,y)$即我们想得到的增强图像。量化的公式如下：
$$
R(x,y) = (r_i-r_{min})*255/(r_{max}-r_{min})
$$
